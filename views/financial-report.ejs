<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Report - TNSTC Finance Planner</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .report-header { text-align: center; margin-bottom: 2rem; }
        .report-header h2 { font-size: 1.5rem; color: #1a3c5e; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
        .date-selector-container { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); max-width: 400px; margin: 0 auto; display: flex; align-items: center; gap: 1rem; margin-bottom: 2.5rem; }
        .date-selector-container label { font-weight: 600; color: #1a3c5e; white-space: nowrap; }
        .date-selector-container input { padding: 0.6rem; border: 1px solid #ddd; border-radius: 6px; width: 100%; }
        
        .report-section { margin-top: 3rem; }
        .section-title { font-size: 1.1rem; font-weight: 800; color: #1a3c5e; border-bottom: 2px solid #1a3c5e; padding-bottom: 0.5rem; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: flex-end; }
        .section-title span { font-size: 0.85rem; font-weight: 600; color: #64748b; }
        
        .horizontal-table { width: 100%; border-collapse: collapse; background: white; margin-bottom: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .horizontal-table th, .horizontal-table td { padding: 1rem; border: 1px solid #e2e8f0; text-align: right; font-size: 0.95rem; }
        .horizontal-table th { background: #f8fafc; color: #1a3c5e; font-weight: 700; text-align: left; }
        .horizontal-table td:first-child { background: #f8fafc; color: #1a3c5e; font-weight: 700; text-align: left; width: 150px; }
        
        .grand-total { text-align: right; font-size: 1.2rem; font-weight: 800; color: #1a3c5e; margin-top: 1rem; }

        .split-section { display: grid; grid-template-columns: 1fr 1fr; border: 2px solid #1a3c5e; background: white; margin-top: 1.5rem; }
        .split-col { padding: 1.5rem; }
        .split-col:first-child { border-right: 2px solid #1a3c5e; }
        .split-header { font-weight: 800; text-align: center; border-bottom: 2px solid #1a3c5e; margin: -1.5rem -1.5rem 1.5rem -1.5rem; padding: 0.8rem; background: #f8fafc; color: #1a3c5e; }
        
        .data-row { display: flex; justify-content: space-between; margin-bottom: 0.8rem; font-size: 0.95rem; }
        .data-row .label { color: #1e293b; }
        .data-row .value { font-weight: 700; color: #1a3c5e; }
        .data-row.highlight { margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem; }
        .data-row.highlight .value { font-size: 1.1rem; color: #1a3c5e; }
        .data-row.balance-row { border-top: 2px solid #1a3c5e; margin-top: 1rem; padding-top: 1rem; }
    </style>
</head>
<body>
    <nav class="sidebar">
        <div class="sidebar-header"><h2>TNSTC Finance</h2></div>
        <ul class="sidebar-menu">
            <li><a href="/">Dashboard</a></li>
            <li><a href="/bank-balances">Bank Balances</a></li>
            <li><a href="/daily-collections">Daily Collections</a></li>
            <li><a href="/payment-planning">Payment Planning</a></li>
            <li><a href="/hsd-management">HSD Management</a></li>
            <li><a href="/financial-report" class="active">Financial Report</a></li>
        </ul>
    </nav>
    <div class="main-content">
        <header>
            <h1>Financial Report</h1>
            <p class="date-range">Finance Position Analysis</p>
        </header>
        <main class="container">
            <div class="report-header">
                <h2>TNSTC KUMBAKONAM â€“ FINANCE POSITION</h2>
            </div>
            <div class="date-selector-container">
                <label for="positionDate">Position Date</label>
                <input type="date" id="positionDate" value="<%= positionDate %>" onchange="window.location.href='/financial-report?positionDate='+this.value">
            </div>

            <!-- Bank Balances Section -->
            <section class="report-section">
                <div class="section-title">
                    BANK BALANCES
                    <span>(Rs. in Crores)</span>
                </div>
                <table class="horizontal-table">
                    <thead>
                        <tr>
                            <th>Bank</th>
                            <% bankData.forEach(bank => { %>
                                <th style="text-align: right;"><%= bank.name %></th>
                            <% }) %>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Balance</td>
                            <% bankData.forEach(bank => { %>
                                <td><%= (bank.balance / 10000000).toFixed(2) %></td>
                            <% }) %>
                        </tr>
                    </tbody>
                </table>
                <div class="grand-total">
                    Total : <%= (totalBankBalance / 10000000).toFixed(2) %>
                </div>
            </section>

            <!-- Collection vs Expenses Section -->
            <section class="report-section">
                <div class="section-title">
                    COLLECTION / EXPENSES
                    <span>(Rs. in Lakhs)</span>
                </div>
                <div class="split-section">
                    <div class="split-col">
                        <div class="split-header">COLLECTION</div>
                        <div class="data-row" style="margin-bottom: 2rem;">
                            <span class="label">Collection Date :</span>
                            <span class="value"><%= collectionInfo ? collectionInfo.toDate : '-' %></span>
                        </div>
                        
                        <div class="data-row">
                            <span class="label">Collection</span>
                            <span class="value"><%= collectionInfo ? (collectionInfo.grossCollection / 100000).toFixed(2) : '0.00' %></span>
                        </div>
                        <div class="data-row">
                            <span class="label">Less Batta 11%</span>
                            <span class="value"><%= collectionInfo ? (collectionInfo.batta / 100000).toFixed(2) : '0.00' %></span>
                        </div>
                        <div class="data-row">
                            <span class="label">Less POS</span>
                            <span class="value"><%= collectionInfo ? (collectionInfo.posCharges / 100000).toFixed(2) : '0.00' %></span>
                        </div>
                        
                        <div class="data-row highlight">
                            <span class="label">Net Collection</span>
                            <span class="value"><%= collectionInfo ? (collectionInfo.netCollection / 100000).toFixed(2) : '0.00' %></span>
                        </div>
                    </div>
                    
                    <div class="split-col">
                        <div class="split-header">EXPENSES</div>
                        <div class="data-row">
                            <span class="label">NET</span>
                            <span class="value"><%= collectionInfo ? (collectionInfo.netCollection / 100000).toFixed(2) : '0.00' %></span>
                        </div>
                        <div class="data-row">
                            <span class="label">Oil Exp</span>
                            <span class="value"><%= (expenseInfo.oilExp / 100000).toFixed(2) %></span>
                        </div>
                        <div class="data-row">
                            <span class="label">Other Exp</span>
                            <span class="value"><%= (expenseInfo.otherExp / 100000).toFixed(2) %></span>
                        </div>
                        
                        <div class="data-row highlight">
                            <span class="label">Total Exp</span>
                            <span class="value"><%= (expenseInfo.totalExp / 100000).toFixed(2) %></span>
                        </div>
                        
                        <div class="data-row balance-row">
                            <span class="label">Balance</span>
                            <span class="value"><%= (expenseInfo.balance / 100000).toFixed(2) %></span>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Other Payments Detail Section -->
            <section class="report-section">
                <div class="section-title">
                    OTHER PAYMENTS
                    <span>(Rs. in Lakhs)</span>
                </div>
                <div class="horizontal-table-container">
                    <table class="horizontal-table" style="text-align: left;">
                        <thead>
                            <tr>
                                <th>Category / Description</th>
                                <th style="text-align: right;">Amount (Lakhs)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (otherPaymentsList.length > 0) { %>
                                <% otherPaymentsList.forEach(item => { %>
                                    <tr>
                                        <td style="text-align: left;"><%= item.subCategory %></td>
                                        <td style="text-align: right;"><%= (item.amount / 100000).toFixed(2) %></td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="2" style="text-align: center; color: #64748b; font-style: italic;">No Other Payments</td>
                                </tr>
                            <% } %>
                        </tbody>
                        <% if (otherPaymentsList.length > 0) { %>
                        <tfoot>
                            <tr style="font-weight: 800; background: #f8fafc;">
                                <td style="text-align: right;">Total :</td>
                                <td style="text-align: right;"><%= (expenseInfo.otherExp / 100000).toFixed(2) %></td>
                            </tr>
                        </tfoot>
                        <% } %>
                    </table>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
